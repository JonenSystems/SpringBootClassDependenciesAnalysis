specification_id: SPC-001.003-001
specification_title: ジェネリクス型参照の解析仕様
## spec:
- [前提] SpringBootアプリケーションのソースコードが`targetProjectPath`配下に存在し、H2インメモリデータベースとJPAプロファイル`jpa`が初期化済であること。
- [入力] 解析オペレータが`targetProjectPath`と`targetPackagePattern`を指定し、`.java`（型引数）を対象にジェネリクス型参照を抽出する。
- [処理] JavaParserを用いて`Type`/`ClassOrInterfaceType`の`getTypeArguments()`で参照型を抽出。抽出結果を依存レコードとして整形し、`class_dependencies`テーブルへ登録する。
- [出力] H2上の`class_dependencies`テーブルにジェネリクス型参照（コレクションや汎用型の実型引数による依存）のレコードを記録し、解析結果画面にパッケージごとのサマリを反映する。
- [制約] 本仕様は静的解析での実行を前提とし、JavaParserが対象ソースを正しくパースできる場合に限定する。

## input_fields:
| 論理名 | 物理名 | 型 | 説明 |
|---|---|---|---|
|解析対象プロジェクトパス|targetProjectPath|String|解析対象となるSpringBootアプリケーションのルートディレクトリ絶対パス。|
|解析対象パッケージパターン|targetPackagePattern|String|依存解析対象とするパッケージをAnt形式で指定（例:`com.example..*`）。|
|解析対象バッチ識別子|analysisBatchId|String|本仕様用の依存種別（例:`001_003`）と紐付く実行ID。|

## output_fields:
| 論理名 | 物理名 | 型 | 保存先（テーブル名） | 説明 |
|---|---|---|---|---|
|依存レコードID|dependencyRecordId|UUID|class_dependencies|依存レコードの主キー。|
|呼出元クラスFQN|sourceClassFqn|String|class_dependencies|依存を検出した呼出元クラスの完全修飾名。|
|依存先識別子|targetIdentifier|String|class_dependencies|ジェネリクス型参照（コレクションや汎用型の実型引数による依存）で参照する対象の完全修飾名。|
|依存種類コード|dependencyKindCode|String|class_dependencies|本仕様に対応する依存種別コード（例:`001_003`）。|
|検出タイムスタンプ|detectedAt|Timestamp|class_dependencies|解析実行時刻。|

## data_flow_diagram:
```mermaid
flowchart TD
    analyzer[外部エンティティ 解析オペレータ]
    sourceRepo[(データストア ソースコードリポジトリ)]
    dependencyStore[(データストア H2依存関係テーブル)]
    proc_req_001_003((プロセス ジェネリクス型参照解析))
    analyzer -- 解析パラメータ --> proc_req_001_003
    sourceRepo -- .java（型引数） --> proc_req_001_003
    proc_req_001_003 -- ジェネリクス型参照依存レコード --> dependencyStore
    dependencyStore -- 解析サマリ --> analyzer
```

## process_flowchart:
```mermaid
flowchart TD
    start([開始])
    inputParams[解析パラメータを受信]
    collect[ジェネリクス型参照対象ソースを走査]
    hasSource{解析対象は存在するか?}
    parse[JavaParserでASTを生成]
    extract[ジェネリクス型参照を抽出]
    persist[依存レコードをH2に保存]
    summarize[パッケージ別サマリを更新]
    finish([終了])

    start --> inputParams --> collect --> hasSource
    hasSource -- はい --> parse --> extract --> persist --> summarize --> finish
    hasSource -- いいえ --> summarize
    summarize --> finish
```
